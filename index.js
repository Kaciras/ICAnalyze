(()=>{"use strict";var e={13909:(e,t,a)=>{var n=a(67294),r=a(73935),l=a(86010);function s(e){e.currentTarget.blur()}function i(e){const{className:t,children:a,title:r,disabled:i,active:c,onClick:o}=e,u=(0,l.Z)("_3zWOC",t,{_2gza9:c});return n.createElement("button",{className:u,title:r,disabled:i,type:"button",onClick:o,onMouseUp:s},a)}var c=a(99870);const o=a.p+"encoding.worker.js",u=()=>{};class m{constructor(e){this.index=0,this.workers=[],this.url=e}onProgress(e){}encode(e,t,a){return this.image=e,this.optionsList=t,this.measure=a,this}async start(e=4){if(!this.image)throw new Error("You should call encode() before start.");if(e<1)throw new Error("Thread count must be at least 1");const t=this.optionsList.length;e=Math.min(e,t),this.results=new Array(t);const a=new Array(e);for(let t=0;t<e;t++){const e=new Worker(this.url),t=c.Ud(e);await t.setImageToEncode(this.image),this.workers.push(e),a.push(this.poll(t))}return Promise.all(a).then((()=>this.results))}stop(){this.workers.forEach((e=>e.terminate()))}async poll(e){const{results:t,optionsList:a,measure:n}=this;for(;this.index<a.length;){const r=this.index++;this.onProgress(r);const l=await e.webpEncode(a[r]),s=await e.webpDecode(l),i=await createImageBitmap(s),c={};if(n.PSNR&&(c.PSNR=await e.calcPSNR(s)),n.SSIM&&(c.SSIM=await e.calcSSIM(s)),n.butteraugli){const[t,a]=await e.calcButteraugli(s),n=await createImageBitmap({data:new Uint8ClampedArray(a),width:i.width,height:i.height});c.butteraugli={source:t,heatMap:n}}t[r]={buffer:l,bitmap:i,metrics:c}}}}function d(e){const{value:t,max:a,onCancel:r}=e;return n.createElement(n.Fragment,null,n.createElement("progress",{id:"progress",value:t,max:a}),n.createElement("button",{onChange:r},"Cancel"))}const p={fieldset:"_3JA-S",header:"_3BPBV",tab:"_3h0pZ",active:"_3_HaH",footer:"_1cBY-",button:"_2GyfY",primary:"_2SWb5",minor:"_1lm_d"},h="YGikD";function E(e){const[t,a]=function(e=0,t=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,r=0){const[l,s]=(0,n.useState)(e);return[l,function(e){if(e>a)e=a;else if(e<t)e=t;else if(0!==r){const t=e/r;Number.isInteger(t)||(e=Math.round(t)*r)}return s(e),e}]}(e.value,e.min,e.max,.5),r=void 0===e.value?e.value:t;function s(t){t=a(t),e.onChange&&e.onChange(t)}return n.createElement("div",{className:"_35DMS"},n.createElement("input",{type:"number",className:"ak06L",disabled:e.disabled,value:r,onChange:e=>s(e.target.valueAsNumber)}),n.createElement("button",{type:"button",className:(0,l.Z)(h,"_1cxWb"),tabIndex:-1,disabled:e.disabled,onClick:()=>s(r+(e.step||1))}),n.createElement("button",{type:"button",className:h,tabIndex:-1,disabled:e.disabled,onClick:()=>s(r-(e.step||1))}))}class g{constructor(e,t,a){this.min=e,this.max=t,this.defaultValue=a}createFixedState(){return this.defaultValue}createFixedInput(e,t){const{min:a,max:r}=this;return n.createElement("label",null,n.createElement("p",null,e),n.createElement("input",{type:"number",min:a,max:r,value:t}))}createVariableState(){return{min:this.min,max:this.max,step:1}}createVariableInput(e,t){const{min:a,max:r}=this;return n.createElement("div",null,n.createElement("p",null,e),n.createElement("label",null,n.createElement("span",null,"min: "),n.createElement(E,{value:t.min,min:a,max:r})),n.createElement("label",null,n.createElement("span",null,"max: "),n.createElement("input",{type:"number",min:a,max:r,value:t.max})),n.createElement("label",null,n.createElement("span",null,"step: "),n.createElement("input",{type:"number",min:a,max:r,value:t.step})))}}const f=[{label:"Quality (-q)",name:"quality",type:new g(0,100,75),defaultVariable:!0},{label:"Method (-m)",name:"method",type:new g(0,6,4)},{label:"Spatial noise shaping (-sns)",name:"sns",type:new g(0,6,4)},{label:"Filter sharpness (-f)",name:"filter_sharpness",type:new g(0,100,4)}];var b;!function(e){e[e.WEBP_HINT_DEFAULT=0]="WEBP_HINT_DEFAULT",e[e.WEBP_HINT_PICTURE=1]="WEBP_HINT_PICTURE",e[e.WEBP_HINT_PHOTO=2]="WEBP_HINT_PHOTO",e[e.WEBP_HINT_GRAPH=3]="WEBP_HINT_GRAPH"}(b||(b={}));const v={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0};var _=a(63851);const N="_32mqE";function w(e){function t(t){e.setFile(t.currentTarget.files[0])}return n.createElement("form",{className:"_25ukj"},n.createElement("label",{className:"_3bhac",tabIndex:0},n.createElement("div",{className:"_3eDV2"},n.createElement(_.Z,null)),n.createElement("div",{className:N},"Drag & drop"),n.createElement("div",{className:N},"Or select an image"),n.createElement("input",{className:"g-JHc",name:"file",type:"file",accept:"image/*",onChange:t})),n.createElement("label",null,n.createElement("span",null,"Or image url"),n.createElement("input",{className:"text-box",name:"url",onChange:t})))}var y=a(14446);function x(e){const{name:t,children:a,checked:r,disabled:s,onChange:i=u}=e;return n.createElement("label",{className:"ZwHw2"},n.createElement("input",{type:"checkbox",className:"_243y6",name:t,disabled:s,onChange:e=>i(e.currentTarget.checked)}),n.createElement("span",{className:(0,l.Z)("_2YZFR",{_3zJKg:r})},n.createElement(y.Z,null)),n.createElement("span",{className:"_3oYw0"},a))}function S(e){const{name:t,children:a,checked:r,disabled:s,onChange:i=u}=e;return n.createElement("label",{className:"_2BtPq"},n.createElement("input",{type:"radio",className:"fvDDZ",name:t,disabled:s,onChange:e=>i(e.currentTarget.checked)}),n.createElement("span",{className:(0,l.Z)("_2osl6",{_3g4e_:r})}),n.createElement("span",{className:"_2H8a2"},a))}function C(e){const{vars:t,options:a,onVarsChange:r}=e,l=[];for(const e of f){const{name:r,type:s}=e,i=a[r]||(a[r]={}),c=t.includes(r);let o;c?("variable"in i||(i.variable=s.createVariableState()),o=s.createVariableInput(r,i.variable)):("fixed"in i||(i.fixed=s.createFixedState()),o=s.createFixedInput(r,i.fixed)),l.push(n.createElement("div",{key:r},n.createElement(S,{checked:c,name:"vars"},r),o))}return n.createElement("form",{className:p.form},l)}function I(e){const{SSIM:t,PSNR:a,butteraugli:r}=e.options;let l;return r&&(l=n.createElement("fieldset",null)),n.createElement("form",{className:p.form},n.createElement("label",null,n.createElement("span",null,"Use pervious Y axis"),n.createElement("select",null,n.createElement("option",null,"(None)"))),n.createElement(x,{checked:t},"Calculate SSIM"),n.createElement(x,{checked:a},"Calculate PSNR"),n.createElement(x,{checked:!!r},"Calculate Butteraugli"),l)}function k(e){const[t,a]=(0,n.useState)(),[r,s]=(0,n.useState)((()=>f.filter((e=>e.defaultVariable)).map((e=>e.name)))),[i,c]=(0,n.useState)({}),[o,u]=(0,n.useState)({SSIM:!1,PSNR:!0,butteraugli:!1}),[m,d]=(0,n.useState)(0),h=["Select File","Options","Metrics"],E=[];for(let e=0;e<h.length;e++){const t=h[e],a=e===m?(0,l.Z)(p.tab,p.active):p.tab;E.push(n.createElement("div",{key:e,className:a,onClick:()=>d(e)},t))}let g;switch(m){case 0:g=n.createElement(w,{setFile:a});break;case 1:g=n.createElement(C,{vars:r,options:i,onVarsChange:s});break;case 2:g=n.createElement(I,{yAxis:[],options:o});break;default:throw new Error}return n.createElement(n.Fragment,null,n.createElement("div",{className:p.header},E),g,n.createElement("div",{className:p.footer},n.createElement("button",{className:(0,l.Z)(p.button,p.minor),onClick:e.onClose},"威威威威阿斯顿"),n.createElement("button",{className:(0,l.Z)(p.button,p.primary),disabled:!t,onClick:function(){const a=new Array(101);for(let e=0;e<101;e++)a[e]={...v,quality:e};e.onStart(t,a,o)}},"Start")))}function P(e){const[t,a]=(0,n.useState)(),[r,l]=(0,n.useState)(1),[s,i]=(0,n.useState)(0);let c;return c=t?n.createElement(d,{value:s,max:r,onCancel:function(){a(void 0),t.stop()}}):n.createElement(k,{onStart:async function(t,n,r){if(!t)throw new Error("File is null");const s=document.createElement("canvas"),c=await createImageBitmap(t),{width:u,height:d}=c;s.width=u,s.height=d;const p=s.getContext("2d");p.drawImage(c,0,0);const h=p.getImageData(0,0,u,d);e.onChange(t,await function(e,t,n){const r=new m(o);return a(r),l(t.length),i(0),r.onProgress=i,r.encode(e,t,n).start()}(h,n,r))},onClose:e.onClose}),n.createElement("div",{className:"_3YekE"},n.createElement("div",{className:"_3xBTO"},c))}var T=a(70596),R=a.n(T);function B(e){const{options:t}=e,[a,r]=(0,n.useState)();return(0,n.useEffect)((()=>null==a?void 0:a.setOption({title:{text:"Quality (-q)"},tooltip:{trigger:"axis"},legend:{data:["Compression Ratio"]},xAxis:{data:t.metrics.map(((e,t)=>t))},yAxis:{},series:[{name:"Compression Ratio %",type:"line",data:t.metrics}]})),[t]),n.createElement("div",{className:"erTiL"},n.createElement("div",{className:"_2TFU8",ref:function(e){e&&r(R().init(e,{renderer:"svg"}))}}))}const O="O8zNb",L={container:"Kom7G",thumbRegion:"_3L2lQ",thumb:"_3iPBZ",input:"_2IK1v"};function M(e){var t;const[a,r]=(0,n.useState)(!1),s=(0,l.Z)(L.thumb,{[L.active]:a}),i={"--value-percent":(null!==(t=e.value)&&void 0!==t?t:0)+"%"};return n.createElement("span",{className:L.container,style:i},n.createElement("input",{type:"range",className:L.input,value:e.value,min:e.min,max:e.max,step:e.step,onChange:e.onChange}),n.createElement("span",{className:L.thumbRegion},n.createElement("span",{className:s})))}var A;function D(e){const{original:t,width:a,height:r,optimized:l}=e,[s,c]=(0,n.useState)(A.Compressed),[o,u]=(0,n.useState)(100),[m,d]=(0,n.useState)(1),[p,h]=(0,n.useState)({x:0,y:0}),g=(0,n.useRef)(null);function f(e){const{children:t,target:a,disabled:r}=e;return n.createElement(i,{disabled:r,active:s===a,onClick:()=>c(a)},t)}function b(){const e=p.x,t=p.y;return(a,n)=>{h({x:e+a,y:t+n})}}(0,n.useEffect)((function(){if(!l)return;const{metrics:e,bitmap:t}=l,a=g.current.getContext("2d");if(!a)throw new Error("Could not create canvas context");s===A.HeatMap?a.drawImage(e.butteraugli.heatMap,0,0):a.drawImage(t,0,0)}),[s,t,l]);let v=null,_=100;s===A.AbsDiff&&(_=o,v=n.createElement("label",null,"Brightness:",n.createElement(E,{value:o,min:100,step:50,onChange:u})));const N={width:a,height:r,"--original":`url("${t}")`,"--scale":m,"--x":p.x+"px","--y":p.y+"px","--brightness":_+"%"},w=s===A.AbsDiff?"difference":void 0,y=!(null==l?void 0:l.metrics.butteraugli);return n.createElement("section",{className:"_3rEMC",onWheel:function(e){const{ctrlKey:t,deltaMode:a}=e;let{deltaY:n}=e;e.preventDefault(),1===a&&(n*=15),d(m*(1-n/(t?100:300)))}},n.createElement("aside",{className:"_36o9S controls"},n.createElement("div",null,n.createElement(f,{target:A.Original},"Original"),n.createElement(f,{target:A.Compressed},"Compressed"),n.createElement(f,{target:A.AbsDiff},"AbsDiff"),n.createElement(f,{disabled:y,target:A.HeatMap},"HeatMap")),v),n.createElement("div",{className:"_1me0h",style:N,onMouseDown:e=>function(e,t){const a=e.pageX,n=e.pageY;function r(e){t(e.pageX-a,e.pageY-n)}document.addEventListener("mousemove",r),document.addEventListener("mouseup",(function e(t){t.preventDefault(),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)}))}(e.nativeEvent,b()),onTouchStart:e=>function(e,t){const a=e.touches[0];function n(e){const n=e.touches[0];t(n.pageX-a.pageX,n.pageY-a.pageY)}document.addEventListener("touchmove",n),document.addEventListener("touchend",(function e(t){t.preventDefault(),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e)}))}(e.nativeEvent,b())},n.createElement("canvas",{className:"_3BNiC",style:{mixBlendMode:w},ref:g,width:a,height:r,hidden:s===A.Original})))}!function(e){e[e.Original=0]="Original",e[e.Compressed=1]="Compressed",e[e.AbsDiff=2]="AbsDiff",e[e.HeatMap=3]="HeatMap"}(A||(A={}));var H=a(5410),F=a(16336),U=a(46196);const Z={original:"",width:0,height:0,outputs:[]};r.render(n.createElement((function(){const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(!1),[l,s]=(0,n.useState)(0),[c,o]=(0,n.useState)(Z),[u,m]=(0,n.useState)("");return n.createElement(n.Fragment,null,n.createElement("section",{className:"_1wERt"},n.createElement(D,Object.assign({},c,{optimized:c.outputs[l]})),a&&n.createElement(B,{options:c}),n.createElement("div",{className:"qRI2y controls"},n.createElement(i,{title:"Select an image",className:O,onClick:()=>t(!0)},n.createElement(H.Z,null)),n.createElement(i,{title:"Show chart",className:O,disabled:c===Z,active:a,onClick:()=>r(!a)},n.createElement(F.Z,null)),n.createElement(i,{title:"Download compressed image",className:O,disabled:c===Z,onClick:function(){const{buffer:e}=c.outputs[l],t=URL.createObjectURL(new Blob([e],{type:"image/webp"}));URL.revokeObjectURL(u),m(t);const a=document.createElement("a");a.href=t,a.download="filename.webp",a.click()}},n.createElement(U.Z,null))),n.createElement("form",{className:"UCi6D controls"},n.createElement("label",null,n.createElement("p",null,"Quality (-q) ",l),n.createElement(M,{value:l,min:0,step:1,max:100,onChange:function(e){const t=e.currentTarget.valueAsNumber;s(t)}})))),e&&n.createElement(P,{onClose:()=>t(!1),onChange:async function(e,a){t(!1),URL.revokeObjectURL(c.original),o({outputs:a,original:URL.createObjectURL(e),width:a[0].bitmap.width,height:a[0].bitmap.height}),s(75)}}))}),null),document.getElementById("root"))}},t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.m=e,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={826:0},t=[[13909,823]],n=()=>{};function r(){for(var n,r=0;r<t.length;r++){for(var l=t[r],s=!0,i=1;i<l.length;i++){var c=l[i];0!==e[c]&&(s=!1)}s&&(t.splice(r--,1),n=a(a.s=l[0]))}return 0===t.length&&(a.x(),a.x=()=>{}),n}a.x=()=>{a.x=()=>{},s=s.slice();for(var e=0;e<s.length;e++)l(s[e]);return(n=r)()};var l=r=>{for(var l,s,[c,o,u,m]=r,d=0,p=[];d<c.length;d++)s=c[d],a.o(e,s)&&e[s]&&p.push(e[s][0]),e[s]=0;for(l in o)a.o(o,l)&&(a.m[l]=o[l]);for(u&&u(a),i(r);p.length;)p.shift()();return m&&t.push.apply(t,m),n()},s=self.webpackChunkic_analyze=self.webpackChunkic_analyze||[],i=s.push.bind(s);s.push=l})(),a.x()})();
//# sourceMappingURL=index.js.map