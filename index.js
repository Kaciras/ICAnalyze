(()=>{"use strict";var e={37329:(e,t,a)=>{var n=a(67294),r=a(73935),l=a(5410),i=a(16336),s=a(46196),c=a(86010);function o(e){e.currentTarget.blur()}function u(e){const{className:t,children:a,title:r,disabled:l,active:i,onClick:s}=e,u=(0,c.Z)("_3zWOC",t,{_2gza9:i});return n.createElement("button",{className:u,title:r,disabled:l,type:"button",onClick:s,onMouseUp:o},a)}var m=a(99870);const d=a.p+"encoding.worker.js",A=()=>{};function p(e,t={}){const{width:a=e.width,height:n=e.height,sx:r=0,sy:l=0,sw:i=e.width,sh:s=e.height}=t,c=document.createElement("canvas");c.width=a,c.height=n;const o=c.getContext("2d");if(!o)throw new Error("Could not create canvas context");return o.drawImage(e,r,l,i,s,0,0,a,n),o.getImageData(0,0,a,n)}new Map,new Map([[/^%PDF-/,"application/pdf"],[/^GIF87a/,"image/gif"],[/^GIF89a/,"image/gif"],[/^\x89PNG\x0D\x0A\x1A\x0A/,"image/png"],[/^\xFF\xD8\xFF/,"image/jpeg"],[/^BM/,"image/bmp"],[/^I I/,"image/tiff"],[/^II*/,"image/tiff"],[/^MM\x00*/,"image/tiff"],[/^RIFF....WEBPVP8[LX ]/,"image/webp"],[/^\x00\x00\x00 ftypavif\x00\x00\x00\x00/,"image/avif"]]);class h{constructor(e){this.index=0,this.workers=[],this.url=e}onProgress(e){}encode(e,t,a){return this.image=e,this.optionsList=t,this.measure=a,this}async start(e=4){if(!this.image)throw new Error("You should call encode() before start.");if(e<1)throw new Error("Thread count must be at least 1");const t=this.optionsList.length;e=Math.min(e,t),this.results=new Array(t);const a=new Array(e);for(let t=0;t<e;t++){const e=new Worker(this.url),t=m.Ud(e);await t.setImageToEncode(this.image),this.workers.push(e),a.push(this.poll(t))}return Promise.all(a).then((()=>this.results))}stop(){this.workers.forEach((e=>e.terminate()))}async poll(e){const{results:t,optionsList:a,measure:n}=this;for(;this.index<a.length;){const r=this.index++;this.onProgress(r);const l=await e.webpEncode(a[r]),[i,s]=await E(l),c={};if(n.PSNR&&(c.PSNR=await e.calcPSNR(i)),n.SSIM&&(c.SSIM=await e.calcSSIM(i)),n.butteraugli){const[t,a]=await e.calcButteraugli(i),n=await createImageBitmap({width:s.width,height:s.height,data:new Uint8ClampedArray(a)});c.butteraugli={source:t,heatMap:n}}t[r]={buffer:l,bitmap:s,metrics:c}}}}async function g(e){const t=await createImageBitmap(e),a=document.createElement("canvas"),{width:n,height:r}=t;a.width=n,a.height=r;const l=a.getContext("2d");return l.drawImage(t,0,0),[l.getImageData(0,0,n,r),t]}function f(e,t,a){let n;return async function(r){return n=await e()?t:a,await n(r)}}const E=f((function(){const e=new Image;return e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",new Promise((t=>{e.onload=()=>t(!0),e.onerror=()=>t(!1)}))}),(function(e){return g(new Blob([e],{type:"image/webp"}))}),(async function(e){const t=m.Ud(new Worker(d)),a=await t.webpDecode(e);return[a,await createImageBitmap(a)]})),b=f((function(){const e=new Image;return e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABYAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgS0AAAAAABNjb2xybmNseAABAAQAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB5tZGF0EgAKBzgADtAQQBkyCRAAAAAP+I9ngw==",new Promise((t=>{e.onload=()=>t(!0),e.onerror=()=>t(!1)}))}),(function(e){return g(new Blob([e],{type:"image/avif"}))}),(async function(e){const t=m.Ud(new Worker(d)),a=await t.avifDecode(e);return[a,await createImageBitmap(a)]}));function v(e){return e=function(e){const t=(new DOMParser).parseFromString(e,"image/svg+xml"),a=t.documentElement;if(a.getAttribute("width")&&a.getAttribute("height"))return e;const n=a.getAttribute("viewBox");if(null===n)throw Error("SVG must have width/height or viewBox");const[,,r,l]=n.split(/\s+/);return a.setAttribute("width",r),a.setAttribute("height",l),(new XMLSerializer).serializeToString(t)}(e),async function(e){const t=URL.createObjectURL(e);try{return await async function(e){const t=new Image;t.decoding="async",t.src=e;const a=new Promise(((e,a)=>{t.onload=()=>e(),t.onerror=()=>a(Error("Image loading error"))}));return t.decode&&await t.decode().catch((()=>null)),await a,t}(t)}finally{URL.revokeObjectURL(t)}}(new Blob([e],{type:"image/svg+xml"})).then(p)}function w(e){const{value:t,max:a,onCancel:r}=e;return n.createElement(n.Fragment,null,n.createElement("span",null,t,"/",a),n.createElement("progress",{id:"progress",value:t,max:a}),n.createElement("button",{onClick:r},"Cancel"))}const x={fieldset:"_3JA-S",header:"_3BPBV",tab:"_3h0pZ",active:"_3_HaH",footer:"_1cBY-",button:"_2GyfY",primary:"_2SWb5",minor:"_1lm_d"},y="YGikD";function _(e){const[t,a]=function(e=0,t=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,r=0){const[l,i]=(0,n.useState)(e);return[l,function(e){if(e>a)e=a;else if(e<t)e=t;else if(0!==r){const t=e/r;Number.isInteger(t)||(e=Math.round(t)*r)}return i(e),e}]}(e.value,e.min,e.max,.5),r=void 0===e.value?e.value:t;function l(t){t=a(t),e.onChange&&e.onChange(t)}return n.createElement("div",{className:"_35DMS"},n.createElement("input",{type:"number",className:"ak06L",disabled:e.disabled,value:r,onChange:e=>l(e.target.valueAsNumber)}),n.createElement("button",{type:"button",className:(0,c.Z)(y,"_1cxWb"),tabIndex:-1,disabled:e.disabled,onClick:()=>l(r+(e.step||1))}),n.createElement("button",{type:"button",className:y,tabIndex:-1,disabled:e.disabled,onClick:()=>l(r-(e.step||1))}))}class N{constructor(e,t,a){this.min=e,this.max=t,this.defaultValue=a}createFixedState(){return this.defaultValue}createFixedInput(e,t){const{min:a,max:r}=this;return n.createElement("label",null,n.createElement("p",null,e),n.createElement("input",{type:"number",min:a,max:r,value:t}))}createVariableState(){return{min:this.min,max:this.max,step:1}}createVariableInput(e,t){const{min:a,max:r}=this;return n.createElement("div",null,n.createElement("p",null,e),n.createElement("label",null,n.createElement("span",null,"min: "),n.createElement(_,{value:t.min,min:a,max:r})),n.createElement("label",null,n.createElement("span",null,"max: "),n.createElement("input",{type:"number",min:a,max:r,value:t.max})),n.createElement("label",null,n.createElement("span",null,"step: "),n.createElement("input",{type:"number",min:a,max:r,value:t.step})))}}const S=[{label:"Quality (-q)",name:"quality",type:new N(0,100,75),defaultVariable:!0},{label:"Method (-m)",name:"method",type:new N(0,6,4)},{label:"Spatial noise shaping (-sns)",name:"sns",type:new N(0,6,4)},{label:"Filter sharpness (-f)",name:"filter_sharpness",type:new N(0,100,4)}];var C;!function(e){e[e.WEBP_HINT_DEFAULT=0]="WEBP_HINT_DEFAULT",e[e.WEBP_HINT_PICTURE=1]="WEBP_HINT_PICTURE",e[e.WEBP_HINT_PHOTO=2]="WEBP_HINT_PHOTO",e[e.WEBP_HINT_GRAPH=3]="WEBP_HINT_GRAPH"}(C||(C={}));const B={quality:75,target_size:0,target_PSNR:0,method:4,sns_strength:50,filter_strength:60,filter_sharpness:0,filter_type:1,partitions:0,segments:4,pass:1,show_compressed:0,preprocessing:0,autofilter:0,partition_limit:0,alpha_compression:1,alpha_filtering:1,alpha_quality:100,lossless:0,exact:0,image_hint:0,emulate_jpeg_size:0,thread_level:0,low_memory:0,near_lossless:100,use_delta_palette:0,use_sharp_yuv:0};var I=a(63851);const k="_32mqE";function P(e){return n.createElement("form",{className:"_25ukj"},n.createElement("label",{className:"_3bhac",tabIndex:0},n.createElement("div",{className:"_3eDV2"},n.createElement(I.Z,null)),n.createElement("div",{className:k},"Drag & drop"),n.createElement("div",{className:k},"Or select an image"),n.createElement("input",{className:"g-JHc",name:"file",type:"file",accept:"image/*",onChange:function(t){e.setFile(t.currentTarget.files[0])}})),n.createElement("label",null,n.createElement("span",null,"Or image url"),n.createElement("input",{className:"text-box",name:"url",onChange:function(t){e.setFile(t.currentTarget.value)}})))}var R=a(14446);function F(e){const{name:t,children:a,checked:r,disabled:l,onChange:i=A}=e;return n.createElement("label",{className:"ZwHw2"},n.createElement("input",{type:"checkbox",className:"_243y6",name:t,disabled:l,onChange:e=>i(e.currentTarget.checked)}),n.createElement("span",{className:(0,c.Z)("_2YZFR",{_3zJKg:r})},n.createElement(R.Z,null)),n.createElement("span",{className:"_3oYw0"},a))}function T(e){const{name:t,children:a,checked:r,disabled:l,onChange:i=A}=e;return n.createElement("label",{className:"_2BtPq"},n.createElement("input",{type:"radio",className:"fvDDZ",name:t,disabled:l,onChange:e=>i(e.currentTarget.checked)}),n.createElement("span",{className:(0,c.Z)("_2osl6",{_3g4e_:r})}),n.createElement("span",{className:"_2H8a2"},a))}function L(e){const{vars:t,options:a,onVarsChange:r}=e,l=[];for(const e of S){const{name:r,type:i}=e,s=a[r]||(a[r]={}),c=t.includes(r);let o;c?("variable"in s||(s.variable=i.createVariableState()),o=i.createVariableInput(r,s.variable)):("fixed"in s||(s.fixed=i.createFixedState()),o=i.createFixedInput(r,s.fixed)),l.push(n.createElement("div",{key:r},n.createElement(T,{checked:c,name:"vars"},r),o))}return n.createElement("form",{className:x.form},l)}function D(e){const{workerCount:t,yAxis:a}=e,{SSIM:r,PSNR:l,butteraugli:i}=e.options;let s;return i&&(s=n.createElement("fieldset",null)),n.createElement("form",{className:x.form},n.createElement("label",null,"Worker count:",n.createElement(_,{min:1,value:t})),n.createElement("label",null,n.createElement("span",null,"Use pervious Y axis"),n.createElement("select",null,n.createElement("option",null,"(None)"))),n.createElement(F,{checked:r},"Calculate SSIM"),n.createElement(F,{checked:l},"Calculate PSNR"),n.createElement(F,{checked:!!i},"Calculate Butteraugli"),s)}function M(e){const[t,a]=(0,n.useState)(),[r,l]=(0,n.useState)((()=>S.filter((e=>e.defaultVariable)).map((e=>e.name)))),[i,s]=(0,n.useState)({}),[o,u]=(0,n.useState)(4),[m,d]=(0,n.useState)({SSIM:!1,PSNR:!0,butteraugli:!1}),[A,p]=(0,n.useState)(0),h=["Select File","Options","Metrics"],g=[];for(let e=0;e<h.length;e++){const t=h[e],a=e===A?(0,c.Z)(x.tab,x.active):x.tab;g.push(n.createElement("div",{key:e,className:a,onClick:()=>p(e)},t))}let f;switch(A){case 0:f=n.createElement(P,{setFile:a});break;case 1:f=n.createElement(L,{vars:r,options:i,onVarsChange:l});break;case 2:f=n.createElement(D,{workerCount:o,yAxis:[],options:m});break;default:throw new Error}return n.createElement(n.Fragment,null,n.createElement("div",{className:x.header},g),f,n.createElement("div",{className:x.footer},n.createElement("button",{className:(0,c.Z)(x.button,x.minor),onClick:e.onClose},"威威威威阿斯顿"),n.createElement("button",{className:(0,c.Z)(x.button,x.primary),disabled:!t,onClick:async function(){const a=new Array(101);for(let e=0;e<101;e++)a[e]={...B,quality:e};if("string"==typeof t){const n=await(await fetch(t)).blob(),r=new URL(t).pathname.split("/").pop(),l=new File([n],r);e.onStart(l,a,m,o)}else e.onStart(t,a,m,o)}},"Start")))}function O(e){const[t,a]=(0,n.useState)(),[r,l]=(0,n.useState)(1),[i,s]=(0,n.useState)(0);let c;return c=t?n.createElement(w,{value:i,max:r,onCancel:function(){a(void 0),t.stop()}}):n.createElement(M,{onStart:async function(t,n,r,i){if(!t)throw new Error("File is null");let c;switch(t.type){case"image/svg+xml":c=await v(await t.text());break;case"image/webp":[c]=await E(await t.arrayBuffer());break;case"image/avif":[c]=await b(await t.arrayBuffer());break;default:[c]=await g(t)}const o=new h(d);a(o),l(n.length),s(0),o.onProgress=s;const u=await o.encode(c,n,r).start(i);e.onChange(t,u)},onClose:e.onClose}),n.createElement("div",{className:"_3YekE"},n.createElement("div",{className:"_3xBTO"},c))}var U=a(70596),W=a.n(U);function Z(e){const{options:t}=e,[a,r]=(0,n.useState)();return(0,n.useEffect)((()=>null==a?void 0:a.setOption({title:{text:"Quality (-q)"},tooltip:{trigger:"axis"},legend:{data:["Compression Ratio"]},xAxis:{data:t.metrics.map(((e,t)=>t))},yAxis:{},series:[{name:"Compression Ratio %",type:"line",data:t.metrics}]})),[t]),n.createElement("div",{className:"erTiL"},n.createElement("div",{className:"_2TFU8",ref:function(e){e&&r(W().init(e,{renderer:"svg"}))}}))}const H="O8zNb",Y={container:"Kom7G",thumbRegion:"_3L2lQ",thumb:"_3iPBZ",input:"_2IK1v"};function j(e){var t;const[a,r]=(0,n.useState)(!1),l=(0,c.Z)(Y.thumb,{[Y.active]:a}),i={"--value-percent":(null!==(t=e.value)&&void 0!==t?t:0)+"%"};return n.createElement("span",{className:Y.container,style:i},n.createElement("input",{type:"range",className:Y.input,value:e.value,min:e.min,max:e.max,step:e.step,onChange:e.onChange}),n.createElement("span",{className:Y.thumbRegion},n.createElement("span",{className:l})))}var G;function V(e){const{original:t,width:a,height:r,optimized:l}=e,[i,s]=(0,n.useState)(G.Compressed),[c,o]=(0,n.useState)(100),[m,d]=(0,n.useState)(""),[A,p]=(0,n.useState)(1),[h,g]=(0,n.useState)({x:0,y:0}),f=(0,n.useRef)(null);function E(e){const{children:t,target:a,disabled:r}=e;return n.createElement(u,{active:i===a,disabled:r,onClick:()=>s(a)},t)}function b(){const e=h.x,t=h.y;return(a,n)=>{g({x:e+a,y:t+n})}}(0,n.useEffect)((function(){if(!t)return;const e=URL.createObjectURL(t);return d(e),()=>URL.revokeObjectURL(e)}),[t]),(0,n.useEffect)((function(){if(!l)return;const{metrics:e,bitmap:t}=l,a=f.current.getContext("2d");if(!a)throw new Error("Could not create canvas context");i===G.HeatMap?a.drawImage(e.butteraugli.heatMap,0,0):a.drawImage(t,0,0)}),[i,l]);let v=null,w=100;i===G.AbsDiff&&(w=c,v=n.createElement("label",null,"Brightness:",n.createElement(_,{value:c,min:100,step:50,onChange:o})));const x={width:a,height:r,"--original":`url("${m}")`,"--scale":A,"--x":h.x+"px","--y":h.y+"px","--brightness":w+"%"},y=i===G.AbsDiff?"difference":void 0,N=!(null==l?void 0:l.metrics.butteraugli);return n.createElement("div",{className:"_3rEMC",onWheel:function(e){const{ctrlKey:t,deltaMode:a}=e;let{deltaY:n}=e;e.preventDefault(),1===a&&(n*=15),p(A*(1-n/(t?100:300)))}},n.createElement("aside",{className:"_36o9S controls"},n.createElement("div",null,n.createElement(E,{target:G.Original},"Original"),n.createElement(E,{target:G.Compressed},"Compressed"),n.createElement(E,{target:G.AbsDiff},"Difference"),n.createElement(E,{disabled:N,target:G.HeatMap},"HeatMap")),v),n.createElement("div",{className:"_1me0h",style:x,onMouseDown:e=>0===e.button&&function(e,t){const a=e.pageX,n=e.pageY;function r(e){t(e.pageX-a,e.pageY-n)}document.addEventListener("mousemove",r),document.addEventListener("mouseup",(function e(t){t.preventDefault(),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)}))}(e.nativeEvent,b()),onTouchStart:e=>function(e,t){const a=e.touches[0];function n(e){const n=e.touches[0];t(n.pageX-a.pageX,n.pageY-a.pageY)}document.addEventListener("touchmove",n),document.addEventListener("touchend",(function e(t){t.preventDefault(),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e)}))}(e.nativeEvent,b())},n.createElement("canvas",{className:"_3BNiC",style:{mixBlendMode:y},ref:f,width:a,height:r,hidden:i===G.Original})))}!function(e){e[e.Original=0]="Original",e[e.Compressed=1]="Compressed",e[e.AbsDiff=2]="AbsDiff",e[e.HeatMap=3]="HeatMap"}(G||(G={}));const Q={original:void 0,width:0,height:0,outputs:[]};function z(e){const{title:t,buffer:a,filename:r,children:l}=e,[i,s]=(0,n.useState)("");return(0,n.useEffect)((()=>()=>URL.revokeObjectURL(i)),[]),n.createElement(u,{className:H,title:t,disabled:!a,onClick:function(){const e=new Blob([a],{type:"image/webp"});URL.revokeObjectURL(i);const t=URL.createObjectURL(e);s(t);const n=document.createElement("a");n.href=i,n.download=r.split(".").pop(),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},l)}r.render(n.createElement((function(){var e,t;const[a,r]=(0,n.useState)(!1),[c,o]=(0,n.useState)(!1),[m,d]=(0,n.useState)(0),[A,p]=(0,n.useState)(Q);return(0,n.useEffect)((()=>o(A!==Q)),[A]),n.createElement(n.Fragment,null,n.createElement(V,Object.assign({},A,{optimized:A.outputs[m]})),c&&n.createElement(Z,Object.assign({},A)),n.createElement("div",{className:"qRI2y controls"},n.createElement(u,{title:"Select an image",className:H,onClick:()=>r(!0)},n.createElement(l.Z,null)),n.createElement(u,{title:"Show chart",className:H,disabled:A===Q,active:c,onClick:()=>o(!c)},n.createElement(i.Z,null)),n.createElement(z,{title:"Download compressed image",filename:null===(e=A.original)||void 0===e?void 0:e.name,buffer:null===(t=A.outputs[m])||void 0===t?void 0:t.buffer},n.createElement(s.Z,null))),n.createElement("div",{className:"UCi6D controls"},n.createElement("label",null,n.createElement("p",null,"Quality (-q) ",m),n.createElement(j,{value:m,min:0,step:1,max:100,onChange:function(e){const t=e.currentTarget.valueAsNumber;d(t)}}))),a&&n.createElement(O,{onClose:()=>r(!1),onChange:async function(e,t){p({outputs:t,original:e,width:t[0].bitmap.width,height:t[0].bitmap.height}),d(75),r(!1)}}))}),null),document.getElementById("root"))}},t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.m=e,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={826:0},t=[[37329,823]],n=()=>{};function r(){for(var n,r=0;r<t.length;r++){for(var l=t[r],i=!0,s=1;s<l.length;s++){var c=l[s];0!==e[c]&&(i=!1)}i&&(t.splice(r--,1),n=a(a.s=l[0]))}return 0===t.length&&(a.x(),a.x=()=>{}),n}a.x=()=>{a.x=()=>{},i=i.slice();for(var e=0;e<i.length;e++)l(i[e]);return(n=r)()};var l=r=>{for(var l,i,[c,o,u,m]=r,d=0,A=[];d<c.length;d++)i=c[d],a.o(e,i)&&e[i]&&A.push(e[i][0]),e[i]=0;for(l in o)a.o(o,l)&&(a.m[l]=o[l]);for(u&&u(a),s(r);A.length;)A.shift()();return m&&t.push.apply(t,m),n()},i=self.webpackChunkic_analyze=self.webpackChunkic_analyze||[],s=i.push.bind(i);i.push=l})(),a.x()})();
//# sourceMappingURL=index.js.map