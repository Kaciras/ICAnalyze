{"version":3,"sources":["webpack://ic-analyze/./web/component/IconButton.tsx","webpack://ic-analyze/./web/component/IconButton.scss","webpack://ic-analyze/./web/worker.ts","webpack://ic-analyze/./web/utils.ts","webpack://ic-analyze/./web/encoding.ts","webpack://ic-analyze/./web/component/ProgressPanel.tsx","webpack://ic-analyze/./web/component/ConfigPanel.scss","webpack://ic-analyze/./web/component/NumberInput.scss","webpack://ic-analyze/./web/component/NumberInput.tsx","webpack://ic-analyze/./web/component/OptionTemplate.tsx","webpack://ic-analyze/./web/options/webp.ts","webpack://ic-analyze/./deps/squoosh/src/codecs/webp/encoder-meta.ts","webpack://ic-analyze/./web/component/SelectFilePanel.scss","webpack://ic-analyze/./web/component/SelectFilePanel.tsx","webpack://ic-analyze/./web/component/CheckBoxInput.tsx","webpack://ic-analyze/./web/component/CheckBoxInput.scss","webpack://ic-analyze/./web/component/RadioInput.tsx","webpack://ic-analyze/./web/component/RadioInput.scss","webpack://ic-analyze/./web/component/OptionsPanel.tsx","webpack://ic-analyze/./web/component/ConfigPanel.tsx","webpack://ic-analyze/./web/component/CompressDialog.tsx","webpack://ic-analyze/./web/component/CompressDialog.scss","webpack://ic-analyze/./web/component/Chart.tsx","webpack://ic-analyze/./web/component/Chart.scss","webpack://ic-analyze/./web/component/App.scss","webpack://ic-analyze/./web/component/RangeInput.scss","webpack://ic-analyze/./web/component/RangeInput.tsx","webpack://ic-analyze/./web/component/ImageView.tsx","webpack://ic-analyze/./web/component/ImageView.scss","webpack://ic-analyze/./web/component/App.tsx","webpack://ic-analyze/./web/index.tsx","webpack://ic-analyze/webpack/bootstrap","webpack://ic-analyze/webpack/runtime/compat get default export","webpack://ic-analyze/webpack/runtime/define property getters","webpack://ic-analyze/webpack/runtime/global","webpack://ic-analyze/webpack/runtime/hasOwnProperty shorthand","webpack://ic-analyze/webpack/runtime/publicPath","webpack://ic-analyze/webpack/runtime/jsonp chunk loading","webpack://ic-analyze/webpack/startup"],"names":["avoidMouseFocus","event","currentTarget","blur","props","className","children","title","disabled","active","onClick","classes","type","onMouseUp","NOOP","BatchEncoder","url","index","workers","this","value","image","optionsList","measure","threadCount","Error","length","Math","min","results","Array","tasks","i","worker","Worker","wrapper","setImageToEncode","push","poll","Promise","all","then","forEach","terminate","onProgress","buffer","webpEncode","data","webpDecode","bitmap","createImageBitmap","metrics","PSNR","calcPSNR","SSIM","calcSSIM","butteraugli","source","raw","calcButteraugli","heatMap","Uint8ClampedArray","width","height","ProgressPanel","max","onCancel","id","onChange","localValue","setLocalValue","init","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","precision","setValue","useState","newValue","s","isInteger","round","useLimitedValue","e","target","valueAsNumber","tabIndex","step","NumberRangeTemplate","defaultValue","name","WebPOptionsTemplate","label","defaultVariable","WebPImageHint","defaultOptions","quality","target_size","target_PSNR","method","sns_strength","filter_strength","filter_sharpness","filter_type","partitions","segments","pass","show_compressed","preprocessing","autofilter","partition_limit","alpha_compression","alpha_filtering","alpha_quality","lossless","exact","image_hint","emulate_jpeg_size","thread_level","low_memory","near_lossless","use_delta_palette","use_sharp_yuv","handleChange","setFile","files","accept","checked","OptionsPanel","vars","options","onVarsChange","fields","template","option","isVariable","includes","element","variable","createVariableState","createVariableInput","fixed","createFixedState","createFixedInput","key","MetricsPanel","bOptions","file","setVars","t","map","setOptions","setMeasure","setIndex","panels","tabs","clazz","panel","yAxis","onClose","onStart","encoder","setEncoder","setMax","progress","setProgress","undefined","stop","async","canvas","document","createElement","ctx","getContext","drawImage","canvasData","getImageData","encode","start","chart","setChart","useEffect","setOption","text","tooltip","trigger","legend","xAxis","_","series","ref","el","renderer","dragging","setDragging","cssVariables","style","ViewType","original","optimized","setType","Compressed","brightness","setBrightness","zoom","setZoom","offset","setOffset","x","y","canvasRef","useRef","ImageViewTab","offsetUpdater","baseX","baseY","dx","dy","current","HeatMap","brightnessInput","brightnessVal","AbsDiff","wrapperCss","blend","butteraugliAvaliable","onWheel","ctrlKey","deltaMode","deltaY","preventDefault","Original","onMouseDown","baseEvent","handler","basePageX","pageX","basePageY","pageY","handleMove","addEventListener","handleEnd","removeEventListener","watchMouseMove","nativeEvent","onTouchStart","basePointer","touches","touch","watchTouchMove","mixBlendMode","hidden","PLACEHOLDER","outputs","showDialog","setShowDialog","showChart","setShowChart","setResults","downloadUrl","setDownloadUrl","URL","createObjectURL","Blob","revokeObjectURL","a","href","download","click","getElementById","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","m","n","getter","__esModule","d","definition","o","Object","defineProperty","enumerable","get","g","globalThis","Function","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","currentScript","src","scripts","getElementsByTagName","replace","p","installedChunks","826","deferredModules","checkDeferredModules","checkDeferredModulesImpl","result","deferredModule","fulfilled","j","depId","splice","chunkLoadingGlobal","slice","webpackJsonpCallback","chunkId","chunkIds","moreModules","runtime","executeModules","resolves","parentChunkLoadingFunction","shift","apply","self","bind"],"mappings":"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","file":"index.js","sourcesContent":["import React, { MouseEvent, MouseEventHandler, ReactNode } from \"react\";\nimport clsx from \"clsx\";\nimport Styles from \"./IconButton.scss\";\n\ninterface Props {\n\ttitle?: string;\n\tclassName?: string;\n\tdisabled?: boolean;\n\tactive?: boolean;\n\tonClick?: MouseEventHandler;\n\tchildren?: ReactNode;\n}\n\nfunction avoidMouseFocus(event: MouseEvent<HTMLElement>) {\n\tevent.currentTarget.blur();\n}\n\nexport default function IconButton(props: Props) {\n\tconst { className, children, title, disabled, active, onClick } = props;\n\n\tconst classes = clsx(\n\t\tStyles.iconButton,\n\t\tclassName,\n\t\t{ [Styles.active]: active },\n\t);\n\n\treturn (\n\t\t<button\n\t\t\tclassName={classes}\n\t\t\ttitle={title}\n\t\t\tdisabled={disabled}\n\t\t\ttype=\"button\"\n\t\t\tonClick={onClick}\n\t\t\tonMouseUp={avoidMouseFocus}\n\t\t>\n\t\t\t{children}\n\t\t</button>\n\t);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"iconButton\":\"_3zWOC\",\"active\":\"_2gza9\"};","export default __webpack_public_path__ + \"encoding.worker.js\"","/**\n * No effect function with a clear name.\n */\nexport const NOOP = () => {};\n\n/**\n * Detect if browser support display AVIF image.\n *\n * @return true if supported, otherwise false.\n */\nexport function detectAVIFSupport() {\n\tconst image = new Image();\n\timage.src = \"data:image/avif;base64,\" +\n\t\t\"AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUEAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAG\" +\n\t\t\"xpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABYAAAAoaWluZgAAAAAAAQAAABppbmZlAgAA\" +\n\t\t\"AAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgS\" +\n\t\t\"0AAAAAABNjb2xybmNseAABAAQAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB5tZGF0EgAKBzgADtAQQBkyCRAAAAAP+I9ngw==\";\n\treturn new Promise<boolean>(resolve => {\n\t\timage.onload = () => resolve(true);\n\t\timage.onerror = () => resolve(false);\n\t});\n}\n\n/**\n * Detect if browser support display WebP image.\n *\n * @return true if supported, otherwise false.\n */\nexport function detectWebPSupport() {\n\tconst image = new Image();\n\timage.src = \"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=\";\n\treturn new Promise<boolean>(resolve => {\n\t\timage.onload = () => resolve(true);\n\t\timage.onerror = () => resolve(false);\n\t});\n}\n","import * as Comlink from \"comlink\";\nimport WorkerUrl from \"worker-plugin/loader?esModule&name=encoding!./worker\";\nimport type { WorkerApi } from \"./worker\";\nimport { detectWebPSupport } from \"./utils\";\nimport { ButteraugliOptions } from \"../lib/metrics\";\n\nexport interface MeasureOptions {\n\tPSNR: boolean;\n\tSSIM: boolean;\n\tbutteraugli: false | ButteraugliOptions;\n}\n\ninterface Metrics {\n\tSSIM?: number;\n\tPSNR?: number;\n\tbutteraugli?: {\n\t\tsource: number;\n\t\theatMap: ImageBitmap;\n\t};\n}\n\nexport interface ConvertOutput {\n\tbuffer: ArrayBuffer;\n\tmetrics: Metrics;\n\tbitmap: ImageBitmap;\n}\n\nexport class BatchEncoder<T> {\n\n\tprivate readonly url: string;\n\n\tprivate image?: ImageData;\n\tprivate optionsList!: T[];\n\tprivate measure!: MeasureOptions;\n\n\tprivate index = 0;\n\tprivate workers: Worker[] = [];\n\n\tprivate results!: ConvertOutput[];\n\n\tconstructor(url: string) {\n\t\tthis.url = url;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tonProgress(value: number) {\n\t\t// noop by default\n\t}\n\n\tencode(image: ImageData, optionsList: T[], measure: MeasureOptions) {\n\t\tthis.image = image;\n\t\tthis.optionsList = optionsList;\n\t\tthis.measure = measure;\n\t\treturn this;\n\t}\n\n\tasync start(threadCount = 4) {\n\t\tif (!this.image) {\n\t\t\tthrow new Error(\"You should call encode() before start.\");\n\t\t}\n\t\tif (threadCount < 1) {\n\t\t\tthrow new Error(\"Thread count must be at least 1\");\n\t\t}\n\n\t\tconst length = this.optionsList.length;\n\t\tthreadCount = Math.min(threadCount, length);\n\n\t\tthis.results = new Array<ConvertOutput>(length);\n\n\t\tconst tasks = new Array(threadCount);\n\n\t\tfor (let i = 0; i < threadCount; i++) {\n\t\t\tconst worker = new Worker(this.url);\n\t\t\tconst wrapper = Comlink.wrap<WorkerApi>(worker);\n\t\t\tawait wrapper.setImageToEncode(this.image);\n\n\t\t\tthis.workers.push(worker);\n\t\t\ttasks.push(this.poll(wrapper));\n\t\t}\n\n\t\treturn Promise.all(tasks).then(() => this.results);\n\t}\n\n\tstop() {\n\t\tthis.workers.forEach(worker => worker.terminate());\n\t}\n\n\tprivate async poll(wrapper: Comlink.Remote<WorkerApi>) {\n\t\tconst { results, optionsList, measure } = this;\n\n\t\twhile (this.index < optionsList.length) {\n\t\t\tconst i = this.index++;\n\t\t\tthis.onProgress(i);\n\n\t\t\tconst buffer = await wrapper.webpEncode(optionsList[i]);\n\t\t\tconst data = await wrapper.webpDecode(buffer);\n\t\t\tconst bitmap = await createImageBitmap(data);\n\n\t\t\tconst metrics: Metrics = {};\n\t\t\tif (measure.PSNR) {\n\t\t\t\tmetrics.PSNR = await wrapper.calcPSNR(data);\n\t\t\t}\n\t\t\tif (measure.SSIM) {\n\t\t\t\tmetrics.SSIM = await wrapper.calcSSIM(data);\n\t\t\t}\n\t\t\tif (measure.butteraugli) {\n\t\t\t\tconst [source, raw] = await wrapper.calcButteraugli(data);\n\t\t\t\tconst heatMap = await createImageBitmap({ data: new Uint8ClampedArray(raw), width: bitmap.width, height: bitmap.height });\n\t\t\t\tmetrics.butteraugli = { source, heatMap };\n\t\t\t}\n\n\t\t\tresults[i] = { buffer, bitmap, metrics };\n\t\t}\n\t}\n}\n\nexport function createWorkers() {\n\treturn new BatchEncoder(WorkerUrl);\n}\n\ntype DecodeResult = [ImageData, ImageBitmap];\n\nasync function decodeImage(blob: Blob) {\n\tconst bitmap = await createImageBitmap(blob);\n\n\tconst canvas = document.createElement(\"canvas\");\n\tconst { width, height } = bitmap;\n\tcanvas.width = width;\n\tcanvas.height = height;\n\n\tconst ctx = canvas.getContext(\"2d\")!;\n\tctx.drawImage(bitmap, 0, 0);\n\tconst imageData = ctx.getImageData(0, 0, width, height);\n\n\treturn [imageData, bitmap] as DecodeResult;\n}\n\ntype featureDetector = () => Promise<boolean>;\ntype DecodeFunction = (buffer: ArrayBuffer) => Promise<DecodeResult>;\n\nfunction decodeFn(\n\tcheckFn: featureDetector,\n\tnative: DecodeFunction,\n\tpolyfill: DecodeFunction,\n) {\n\tlet bestDecodeFn;\n\n\treturn async function choose(buffer: ArrayBuffer) {\n\t\tif (await checkFn()) {\n\t\t\tbestDecodeFn = native;\n\t\t} else {\n\t\t\tbestDecodeFn = polyfill;\n\t\t}\n\t\treturn await bestDecodeFn(buffer);\n\t};\n}\n\nexport const decodeWebP = decodeFn(\n\tdetectWebPSupport,\n\tdecodeAVIFNative,\n\tdecodeAVIFWorker);\n\nfunction decodeAVIFNative(buffer: ArrayBuffer) {\n\treturn decodeImage(new Blob([buffer], { type: \"image/avif\" }));\n}\n\nasync function decodeAVIFWorker(buffer: ArrayBuffer) {\n\tconst worker = Comlink.wrap<WorkerApi>(new Worker(WorkerUrl));\n\tconst imageData = await worker.avifDecode(buffer);\n\tconst bitmap = await createImageBitmap(imageData);\n\treturn [imageData, bitmap] as DecodeResult;\n}\n\nlet decodeAVIF: (buffer: ArrayBuffer) => Promise<ImageData>;\n","import React from \"react\";\n\ninterface ProgressPanelProps {\n\tmax: number;\n\tvalue: number;\n\tonCancel: () => void;\n}\n\nexport default function ProgressPanel(props: ProgressPanelProps) {\n\tconst { value, max, onCancel } = props;\n\treturn (\n\t\t<>\n\t\t\t<progress id=\"progress\" value={value} max={max}/>\n\t\t\t<button onChange={onCancel}>Cancel</button>\n\t\t</>\n\t);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"fieldset\":\"_3JA-S\",\"header\":\"_3BPBV\",\"tab\":\"_3h0pZ\",\"active\":\"_3_HaH\",\"footer\":\"_1cBY-\",\"button\":\"_2GyfY\",\"primary\":\"_2SWb5\",\"minor\":\"_1lm_d\"};","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"_35DMS\",\"input\":\"ak06L\",\"button\":\"YGikD\",\"plus\":\"_1cxWb\"};","import React, { useState } from \"react\";\nimport clsx from \"clsx\";\nimport Style from \"./NumberInput.scss\";\n\ninterface Props {\n\tvalue?: number;\n\tmin?: number;\n\tmax?: number;\n\tstep?: number;\n\tprecision?: number;\n\n\tdisabled?: boolean;\n\n\tonChange?(value: number): void;\n}\n\nfunction useLimitedValue(\n\tinit = 0,\n\tmin: number = Number.NEGATIVE_INFINITY,\n\tmax: number = Number.POSITIVE_INFINITY,\n\tprecision = 0,\n): [number, (v: number) => number] {\n\n\tconst [value, setValue] = useState(init);\n\n\tfunction setValueLimited(newValue: number) {\n\t\tif (newValue > max) {\n\t\t\tnewValue = max;\n\t\t} else if (newValue < min) {\n\t\t\tnewValue = min;\n\t\t} else if (precision !== 0) {\n\t\t\tconst s = newValue / precision;\n\t\t\tif (!Number.isInteger(s)) {\n\t\t\t\tnewValue = Math.round(s) * precision;\n\t\t\t}\n\t\t}\n\t\tsetValue(newValue);\n\t\treturn newValue;\n\t}\n\n\treturn [value, setValueLimited];\n}\n\nexport default function NumberInput(props: Props) {\n\tconst [localValue, setLocalValue] = useLimitedValue(props.value, props.min, props.max, 0.5);\n\n\tconst value = typeof props.value === \"undefined\" ? props.value : localValue;\n\n\tfunction setValue(newValue: number) {\n\t\tnewValue = setLocalValue(newValue);\n\t\tif (props.onChange) {\n\t\t\tprops.onChange(newValue);\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className={Style.container}>\n\t\t\t<input\n\t\t\t\ttype=\"number\"\n\t\t\t\tclassName={Style.input}\n\t\t\t\tdisabled={props.disabled}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={(e) => setValue(e.target.valueAsNumber)}\n\t\t\t/>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclassName={clsx(Style.button, Style.plus)}\n\t\t\t\ttabIndex={-1}\n\t\t\t\tdisabled={props.disabled}\n\t\t\t\tonClick={() => setValue(value + (props.step || 1))}\n\t\t\t/>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclassName={Style.button}\n\t\t\t\ttabIndex={-1}\n\t\t\t\tdisabled={props.disabled}\n\t\t\t\tonClick={() => setValue(value - (props.step || 1))}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n","import React from \"react\";\nimport NumberInput from \"./NumberInput\";\n\n// 互斥mode\n\nexport interface OptionType<F, V> {\n\n\tcreateFixedState(): F;\n\n\tcreateFixedInput(name: string, value: F): React.ReactElement;\n\n\tcreateVariableState(): V;\n\n\tcreateVariableInput(name: string, value: V): React.ReactElement;\n}\n\nexport class NumberRangeTemplate implements OptionType<any, any> {\n\n\treadonly min: number;\n\treadonly max: number;\n\treadonly defaultValue: number;\n\n\tconstructor(min: number, max: number, defaultValue: number) {\n\t\tthis.min = min;\n\t\tthis.max = max;\n\t\tthis.defaultValue = defaultValue;\n\t}\n\n\tcreateFixedState() {\n\t\treturn this.defaultValue;\n\t}\n\n\tcreateFixedInput(name: string, value: number) {\n\t\tconst { min, max } = this;\n\t\treturn (\n\t\t\t<label>\n\t\t\t\t<p>{name}</p>\n\t\t\t\t<input type=\"number\" min={min} max={max} value={value}/>\n\t\t\t</label>\n\t\t);\n\t}\n\n\tcreateVariableState() {\n\t\treturn {\n\t\t\tmin: this.min,\n\t\t\tmax: this.max,\n\t\t\tstep: 1,\n\t\t};\n\t}\n\n\tcreateVariableInput(name: string, value: any) {\n\t\tconst { min, max } = this;\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<p>{name}</p>\n\t\t\t\t<label>\n\t\t\t\t\t<span>min: </span>\n\t\t\t\t\t<NumberInput value={value.min} min={min} max={max}/>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>max: </span>\n\t\t\t\t\t<input type=\"number\" min={min} max={max} value={value.max}/>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>step: </span>\n\t\t\t\t\t<input type=\"number\" min={min} max={max} value={value.step}/>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport class BooleanTemplate {\n\n}\n\nexport class EnumTemplate implements OptionType<any, any> {\n\n\tprivate readonly names: string[];\n\tprivate readonly defaultValue: string;\n\n\tconstructor(names: string[], defaultValue: string) {\n\t\tthis.names = names;\n\t\tthis.defaultValue = defaultValue;\n\t}\n\n\tcreateFixedInput(name: string, value: any): React.ReactElement {\n\t\treturn null;\n\t}\n\n\tcreateFixedState() {\n\t\treturn this.defaultValue;\n\t}\n\n\tcreateVariableInput(name: string, value: any): React.ReactElement {\n\t\treturn null;\n\t}\n\n\tcreateVariableState(): any {\n\t\treturn this.names;\n\t}\n}\n\n","import { OptionTemplate } from \"./index\";\nimport { NumberRangeTemplate } from \"../component/OptionTemplate\";\n\nexport const WebPOptionsTemplate: OptionTemplate[] = [\n\t{\n\t\tlabel: \"Quality (-q)\",\n\t\tname: \"quality\",\n\t\ttype: new NumberRangeTemplate(0, 100, 75),\n\t\tdefaultVariable: true,\n\t},\n\t{\n\t\tlabel: \"Method (-m)\",\n\t\tname: \"method\",\n\t\ttype: new NumberRangeTemplate(0, 6, 4),\n\t},\n\t{\n\t\tlabel: \"Spatial noise shaping (-sns)\",\n\t\tname: \"sns\",\n\t\ttype: new NumberRangeTemplate(0, 6, 4),\n\t},\n\t{\n\t\tlabel: \"Filter sharpness (-f)\",\n\t\tname: \"filter_sharpness\",\n\t\ttype: new NumberRangeTemplate(0, 100, 4),\n\t},\n];\n","export enum WebPImageHint {\n  WEBP_HINT_DEFAULT, // default preset.\n  WEBP_HINT_PICTURE, // digital picture, like portrait, inner shot\n  WEBP_HINT_PHOTO,   // outdoor photograph, with natural lighting\n  WEBP_HINT_GRAPH,   // Discrete tone image (graph, map-tile etc).\n}\n\nexport interface EncodeOptions {\n  quality: number;\n  target_size: number;\n  target_PSNR: number;\n  method: number;\n  sns_strength: number;\n  filter_strength: number;\n  filter_sharpness: number;\n  filter_type: number;\n  partitions: number;\n  segments: number;\n  pass: number;\n  show_compressed: number;\n  preprocessing: number;\n  autofilter: number;\n  partition_limit: number;\n  alpha_compression: number;\n  alpha_filtering: number;\n  alpha_quality: number;\n  lossless: number;\n  exact: number;\n  image_hint: number;\n  emulate_jpeg_size: number;\n  thread_level: number;\n  low_memory: number;\n  near_lossless: number;\n  use_delta_palette: number;\n  use_sharp_yuv: number;\n}\nexport interface EncoderState { type: typeof type; options: EncodeOptions; }\n\nexport const type = 'webp';\nexport const label = 'WebP';\nexport const mimeType = 'image/webp';\nexport const extension = 'webp';\n// These come from struct WebPConfig in encode.h.\nexport const defaultOptions: EncodeOptions = {\n  quality: 75,\n  target_size: 0,\n  target_PSNR: 0,\n  method: 4,\n  sns_strength: 50,\n  filter_strength: 60,\n  filter_sharpness: 0,\n  filter_type: 1,\n  partitions: 0,\n  segments: 4,\n  pass: 1,\n  show_compressed: 0,\n  preprocessing: 0,\n  autofilter: 0,\n  partition_limit: 0,\n  alpha_compression: 1,\n  alpha_filtering: 1,\n  alpha_quality: 100,\n  lossless: 0,\n  exact: 0,\n  image_hint: 0,\n  emulate_jpeg_size: 0,\n  thread_level: 0,\n  low_memory: 0,\n  near_lossless: 100,\n  use_delta_palette: 0,\n  use_sharp_yuv: 0,\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"form\":\"_25ukj\",\"uploadFile\":\"_3bhac\",\"icon\":\"_3eDV2\",\"text\":\"_32mqE\",\"fileInput\":\"g-JHc\"};","import React, { ChangeEvent, Dispatch } from \"react\";\nimport ImageIcon from \"bootstrap-icons/icons/image.svg\";\nimport Styles from \"./SelectFilePanel.scss\";\n\ninterface SFProps {\n\tsetFile: Dispatch<File>\n}\n\nexport default function SelectFilePanel(props: SFProps) {\n\n\tfunction handleChange(event: ChangeEvent<HTMLInputElement>) {\n\t\tprops.setFile(event.currentTarget.files![0]);\n\t}\n\n\treturn (\n\t\t<form className={Styles.form}>\n\t\t\t<label className={Styles.uploadFile} tabIndex={0}>\n\t\t\t\t<div className={Styles.icon}>\n\t\t\t\t\t<ImageIcon/>\n\t\t\t\t</div>\n\t\t\t\t<div className={Styles.text}>\n\t\t\t\t\tDrag & drop\n\t\t\t\t</div>\n\t\t\t\t<div className={Styles.text}>\n\t\t\t\t\tOr select an image\n\t\t\t\t</div>\n\t\t\t\t<input\n\t\t\t\t\tclassName={Styles.fileInput}\n\t\t\t\t\tname=\"file\"\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\tonChange={handleChange}\n\t\t\t\t/>\n\t\t\t</label>\n\t\t\t<label>\n\t\t\t\t<span>Or image url</span>\n\t\t\t\t<input className=\"text-box\" name=\"url\" onChange={handleChange}/>\n\t\t\t</label>\n\t\t</form>\n\t);\n}\n","import React, { Dispatch, ReactNode } from \"react\";\nimport clsx from \"clsx\";\nimport CheckIcon from \"bootstrap-icons/icons/check2.svg\";\nimport { NOOP } from \"../utils\";\nimport Styles from \"./CheckBoxInput.scss\";\n\ninterface Props {\n\tchecked: boolean;\n\tname?: string;\n\tdisabled?: boolean;\n\tonChange?: Dispatch<boolean>;\n\tchildren?: ReactNode;\n}\n\nexport default function CheckBoxInput(props: Props) {\n\tconst { name, children, checked, disabled, onChange = NOOP } = props;\n\treturn (\n\t\t<label className={Styles.container}>\n\t\t\t<input\n\t\t\t\ttype=\"checkbox\"\n\t\t\t\tclassName={Styles.input}\n\t\t\t\tname={name}\n\t\t\t\tdisabled={disabled}\n\t\t\t\tonChange={e => onChange(e.currentTarget.checked)}\n\t\t\t/>\n\t\t\t<span\n\t\t\t\tclassName={clsx(Styles.mark, { [Styles.checked]: checked })}\n\t\t\t>\n\t\t\t\t<CheckIcon/>\n\t\t\t</span>\n\t\t\t<span className={Styles.label}>{children}</span>\n\t\t</label>\n\t);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"ZwHw2\",\"input\":\"_243y6\",\"mark\":\"_2YZFR\",\"checked\":\"_3zJKg\",\"label\":\"_3oYw0\"};","import React, { Dispatch, ReactNode } from \"react\";\nimport clsx from \"clsx\";\nimport Styles from \"./RadioInput.scss\";\nimport { NOOP } from \"../utils\";\n\ninterface Props {\n\tchecked: boolean;\n\tname: string;\n\tdisabled?: boolean;\n\tonChange?: Dispatch<boolean>;\n\tchildren?: ReactNode;\n}\n\nexport default function RadioInput(props: Props) {\n\tconst { name, children, checked, disabled, onChange = NOOP } = props;\n\n\treturn (\n\t\t<label className={Styles.container}>\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tclassName={Styles.input}\n\t\t\t\tname={name}\n\t\t\t\tdisabled={disabled}\n\t\t\t\tonChange={e => onChange(e.currentTarget.checked)}\n\t\t\t/>\n\t\t\t<span className={clsx(Styles.mark, { [Styles.checked]: checked })}/>\n\t\t\t<span className={Styles.label}>{children}</span>\n\t\t</label>\n\t);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"_2BtPq\",\"input\":\"fvDDZ\",\"mark\":\"_2osl6\",\"checked\":\"_3g4e_\",\"label\":\"_2H8a2\"};","import React, { Dispatch, FormEvent } from \"react\";\nimport { WebPOptionsTemplate } from \"../options\";\nimport RadioInput from \"./RadioInput\";\nimport Styles from \"./ConfigPanel.scss\";\n\nexport interface OptionsInstance {\n\t[key: string]: {\n\t\tfixed?: any;\n\t\tvariable?: any;\n\t}\n}\n\ninterface Props {\n\tvars: string[];\n\tonVarsChange: Dispatch<string[]>;\n\toptions: any;\n}\n\nexport default function OptionsPanel(props: Props) {\n\tconst { vars, options, onVarsChange } = props;\n\n\tconst fields: React.ReactElement[] = [];\n\n\tfor (const template of WebPOptionsTemplate) {\n\t\tconst { name, type } = template;\n\t\tconst option = options[name] ||= {};\n\n\t\tconst isVariable = vars.includes(name);\n\t\tlet element;\n\n\t\tif (isVariable) {\n\t\t\tif (!(\"variable\" in option)) {\n\t\t\t\toption.variable = type.createVariableState();\n\t\t\t}\n\t\t\telement = type.createVariableInput(name, option.variable);\n\t\t} else {\n\t\t\tif (!(\"fixed\" in option)) {\n\t\t\t\toption.fixed = type.createFixedState();\n\t\t\t}\n\t\t\telement = type.createFixedInput(name, option.fixed);\n\t\t}\n\n\t\tconst radioChange = (e: FormEvent<HTMLInputElement>) => {\n\t\t\tif (e.currentTarget.checked) onVarsChange([name]);\n\t\t};\n\n\t\tfields.push(\n\t\t\t<div key={name}>\n\t\t\t\t<RadioInput\n\t\t\t\t\tchecked={isVariable}\n\t\t\t\t\tname=\"vars\"\n\t\t\t\t>\n\t\t\t\t\t{name}\n\t\t\t\t</RadioInput>\n\t\t\t\t{element}\n\t\t\t</div>);\n\t}\n\n\treturn <form className={Styles.form}>{fields}</form>;\n}\n","import React, { FormEvent, useState } from \"react\";\nimport clsx from \"clsx\";\nimport Styles from \"./ConfigPanel.scss\";\nimport { WebPOptionsTemplate } from \"../options\";\nimport { defaultOptions, EncodeOptions } from \"squoosh/src/codecs/webp/encoder-meta\";\nimport SelectFilePanel from \"./SelectFilePanel\";\nimport { MeasureOptions } from \"../encoding\";\nimport CheckBoxInput from \"./CheckBoxInput\";\nimport OptionsPanel, { OptionsInstance } from \"./OptionsPanel\";\n\ninterface MProps {\n\tyAxis: string[];\n\toptions: MeasureOptions;\n}\n\nfunction MetricsPanel(props: MProps) {\n\tconst { SSIM, PSNR, butteraugli } = props.options;\n\n\tlet bOptions;\n\tif (butteraugli) {\n\t\tbOptions = (\n\t\t\t<fieldset>\n\n\t\t\t</fieldset>\n\t\t);\n\t}\n\n\treturn (\n\t\t<form className={Styles.form}>\n\t\t\t<label>\n\t\t\t\t<span>Use pervious Y axis</span>\n\t\t\t\t<select>\n\t\t\t\t\t<option>(None)</option>\n\t\t\t\t</select>\n\t\t\t</label>\n\t\t\t<CheckBoxInput checked={SSIM}>Calculate SSIM</CheckBoxInput>\n\t\t\t<CheckBoxInput checked={PSNR}>Calculate PSNR</CheckBoxInput>\n\t\t\t<CheckBoxInput checked={!!butteraugli}>Calculate Butteraugli</CheckBoxInput>\n\t\t\t{bOptions}\n\t\t</form>\n\t);\n}\n\ninterface Props {\n\tonStart: (file: File, optionsList: any[], measure: MeasureOptions) => void;\n\tonClose: () => void;\n}\n\nexport default function ConfigPanel(props: Props) {\n\tconst [file, setFile] = useState<File>();\n\n\tconst [vars, setVars] = useState<string[]>(() => WebPOptionsTemplate\n\t\t.filter(t => t.defaultVariable).map(t => t.name));\n\n\tconst [options, setOptions] = useState<OptionsInstance>({});\n\n\tconst [measure, setMeasure] = useState<MeasureOptions>({\n\t\tSSIM: false,\n\t\tPSNR: true,\n\t\tbutteraugli: false,\n\t});\n\n\tfunction loadFile(event: FormEvent<HTMLInputElement>) {\n\t\tsetFile(event.currentTarget.files![0]);\n\t}\n\n\t// TODO: stub options\n\tfunction start() {\n\t\tconst optionsList = new Array<EncodeOptions>(101);\n\t\tfor (let i = 0; i < 101; i++) {\n\t\t\toptionsList[i] = { ...defaultOptions, quality: i };\n\t\t}\n\t\tprops.onStart(file!, optionsList, measure);\n\t}\n\n\tconst [index, setIndex] = useState(0);\n\n\tconst panels = [\"Select File\", \"Options\",\"Metrics\"];\n\n\tconst tabs = [];\n\tfor (let i = 0; i < panels.length; i++) {\n\t\tconst name = panels[i];\n\t\tconst clazz = i === index ? clsx(Styles.tab, Styles.active) : Styles.tab;\n\t\ttabs.push(<div key={i} className={clazz} onClick={() => setIndex(i)}>{name}</div>);\n\t}\n\n\tlet panel;\n\n\tswitch (index) {\n\t\tcase 0:\n\t\t\tpanel = <SelectFilePanel setFile={setFile}/>;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tpanel = <OptionsPanel\n\t\t\t\tvars={vars}\n\t\t\t\toptions={options}\n\t\t\t\tonVarsChange={setVars}\n\t\t\t/>;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tpanel = <MetricsPanel yAxis={[]} options={measure}/>;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error();\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<div className={Styles.header}>{tabs}</div>\n\t\t\t{panel}\n\t\t\t<div className={Styles.footer}>\n\t\t\t\t<button\n\t\t\t\t\tclassName={clsx(Styles.button, Styles.minor)}\n\t\t\t\t\tonClick={props.onClose}\n\t\t\t\t>\n\t\t\t\t\t威威威威阿斯顿\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclassName={clsx(Styles.button, Styles.primary)}\n\t\t\t\t\tdisabled={!file}\n\t\t\t\t\tonClick={start}\n\t\t\t\t>\n\t\t\t\t\tStart\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</>\n\t);\n}\n","import React, { useState } from \"react\";\nimport Styles from \"./CompressDialog.scss\";\nimport { BatchEncoder, ConvertOutput, createWorkers, MeasureOptions } from \"../encoding\";\nimport ProgressPanel from \"./ProgressPanel\";\nimport ConfigPanel from \"./ConfigPanel\";\n\ninterface Props {\n\tonChange: (file: File, results: ConvertOutput[]) => void;\n\tonClose: () => void;\n}\n\nexport default function CompressDialog(props: Props) {\n\tconst [encoder, setEncoder] = useState<BatchEncoder<unknown>>();\n\n\tconst [max, setMax] = useState(1);\n\tconst [progress, setProgress] = useState(0);\n\n\tasync function handleStart(file: File, optionsList: any[], measure: MeasureOptions) {\n\t\tif (!file) {\n\t\t\tthrow new Error(\"File is null\");\n\t\t}\n\n\t\tconst canvas = document.createElement(\"canvas\");\n\t\tconst bitmap = await createImageBitmap(file);\n\t\tconst { width, height } = bitmap;\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\tconst ctx = canvas.getContext(\"2d\")!;\n\t\tctx.drawImage(bitmap, 0, 0);\n\t\tconst canvasData = ctx.getImageData(0, 0, width, height);\n\n\t\tprops.onChange(file, await encode(canvasData, optionsList, measure));\n\t}\n\n\tfunction encode(image: ImageData, optionsList: any[], measure: MeasureOptions) {\n\t\tconst encoder = createWorkers();\n\n\t\tsetEncoder(encoder);\n\t\tsetMax(optionsList.length);\n\t\tsetProgress(0);\n\n\t\tencoder.onProgress = setProgress;\n\t\treturn encoder.encode(image, optionsList, measure).start();\n\t}\n\n\tfunction stop() {\n\t\tsetEncoder(undefined);\n\t\tencoder!.stop();\n\t}\n\n\tlet panel;\n\n\tif (encoder) {\n\t\tpanel = <ProgressPanel value={progress} max={max} onCancel={stop}/>;\n\t} else {\n\t\tpanel = <ConfigPanel onStart={handleStart} onClose={props.onClose}/>;\n\t}\n\n\treturn (\n\t\t<div className={Styles.dimmer}>\n\t\t\t<div className={Styles.dialog}>\n\t\t\t\t{panel}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"dimmer\":\"_3YekE\",\"dialog\":\"_3xBTO\"};","import React, { useEffect, useState } from \"react\";\nimport echarts, { ECharts } from \"echarts\";\nimport Styles from \"./Chart.scss\";\n\ninterface Props {\n\toptions: any;\n}\n\n// setChartOptions({\n// \ttitle: {\n// \t\ttext: \"Quality (-q)\",\n// \t},\n// \ttooltip: {\n// \t\ttrigger: \"axis\",\n// \t},\n// \tlegend: {\n// \t\tdata: [\"Compression Ratio\"],\n// \t},\n// \txAxis: {\n// \t\tdata: encodedFiles.map((_, i) => i),\n// \t},\n// \tyAxis: {},\n// \tseries: [{\n// \t\tname: \"Compression Ratio %\",\n// \t\ttype: \"line\",\n// \t\tdata: encodedFiles.map(({ length }) => length / file.size * 100),\n// \t}],\n// });\n\nexport default function Chart(props: Props) {\n\tconst { options } = props;\n\tconst [chart, setChart] = useState<ECharts>();\n\n\tfunction initEchart(el: HTMLDivElement | null) {\n\t\tif (!el) {\n\t\t\treturn;\n\t\t}\n\t\tsetChart(echarts.init(el, { renderer: \"svg\" }));\n\t}\n\n\tuseEffect(() => chart?.setOption({\n\t\ttitle: {\n\t\t\ttext: \"Quality (-q)\",\n\t\t},\n\t\ttooltip: {\n\t\t\ttrigger: \"axis\",\n\t\t},\n\t\tlegend: {\n\t\t\tdata: [\"Compression Ratio\"],\n\t\t},\n\t\txAxis: {\n\t\t\tdata: options.metrics.map((_, i) => i),\n\t\t},\n\t\tyAxis: {},\n\t\tseries: [{\n\t\t\tname: \"Compression Ratio %\",\n\t\t\ttype: \"line\",\n\t\t\tdata: options.metrics,\n\t\t}],\n\t}), [options]);\n\n\treturn <div className={Styles.container}><div className={Styles.chart} ref={initEchart}/></div>;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"erTiL\",\"chart\":\"_2TFU8\"};","// extracted by mini-css-extract-plugin\nexport default {\"main\":\"_1wERt\",\"buttonGroup\":\"qRI2y controls\",\"variableGroup\":\"UCi6D controls\",\"iconButton\":\"O8zNb\"};","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"Kom7G\",\"thumbRegion\":\"_3L2lQ\",\"thumb\":\"_3iPBZ\",\"input\":\"_2IK1v\"};","import React, { CSSProperties, FormEvent, useState } from \"react\";\nimport clsx from \"clsx\";\nimport Styles from \"./RangeInput.scss\";\n\ninterface Props {\n\tvalue?: number;\n\tmin?: number;\n\tmax?: number;\n\tstep?: number;\n\n\tdisabled?: boolean;\n\n\tonChange(e: FormEvent<HTMLInputElement>):void\n}\n\ninterface RangeInputCSS extends CSSProperties {\n\t\"--value-percent\": string;\n}\n\nexport default function RangeInput(props: Props) {\n\tconst [dragging, setDragging] = useState(false);\n\n\tfunction mouseMove() {\n\t\tsetDragging(true);\n\n\t\tfunction moveEnd(event: Event) {\n\t\t\tevent.preventDefault();\n\t\t\tsetDragging(false);\n\t\t\tdocument.removeEventListener(\"mouseup\", moveEnd);\n\t\t}\n\n\t\tdocument.addEventListener(\"mouseup\", moveEnd);\n\t}\n\n\tfunction touchMove() {\n\t\tsetDragging(true);\n\n\t\tfunction moveEnd(event: Event) {\n\t\t\tevent.preventDefault();\n\t\t\tsetDragging(false);\n\t\t\tdocument.removeEventListener(\"touchend\", moveEnd);\n\t\t}\n\n\t\tdocument.addEventListener(\"touchend\", moveEnd);\n\t}\n\n\tconst classes = clsx(\n\t\tStyles.thumb,\n\t\t{ [Styles.active]: dragging },\n\t);\n\n\tconst cssVariables: RangeInputCSS = {\n\t\t\"--value-percent\": `${props.value ?? 0}%`,\n\t};\n\n\treturn (\n\t\t<span\n\t\t\tclassName={Styles.container}\n\t\t\tstyle={cssVariables}\n\t\t>\n\t\t\t<input\n\t\t\t\ttype=\"range\"\n\t\t\t\tclassName={Styles.input}\n\t\t\t\tvalue={props.value}\n\t\t\t\tmin={props.min}\n\t\t\t\tmax={props.max}\n\t\t\t\tstep={props.step}\n\t\t\t\tonChange={props.onChange}\n\t\t\t/>\n\n\t\t\t<span className={Styles.thumbRegion}>\n\t\t\t\t<span className={classes}/>\n\t\t\t</span>\n\t\t</span>\n\t);\n}\n","import React, { CSSProperties, ReactNode, useEffect, useRef, useState, WheelEvent } from \"react\";\nimport IconButton from \"./IconButton\";\nimport NumberInput from \"./NumberInput\";\nimport Styles from \"./ImageView.scss\";\nimport { ConvertOutput } from \"../encoding\";\n\ninterface Props {\n\toriginal: string;\n\twidth: number;\n\theight: number;\n\toptimized?: ConvertOutput;\n}\n\nexport enum ViewType {\n\tOriginal,\n\tCompressed,\n\tAbsDiff,\n\tHeatMap,\n}\n\ninterface ImageViewCSS extends CSSProperties {\n\t\"--original\": string;\n\t\"--x\": string;\n\t\"--y\": string;\n\t\"--scale\": number;\n\t\"--brightness\": string;\n}\n\ntype PointerMoveHandler = (dx: number, dy: number) => void;\n\nfunction watchMouseMove(baseEvent: MouseEvent, handler: PointerMoveHandler) {\n\tconst basePageX = baseEvent.pageX;\n\tconst basePageY = baseEvent.pageY;\n\n\tfunction handleMove(event: MouseEvent) {\n\t\thandler(event.pageX - basePageX, event.pageY - basePageY);\n\t}\n\n\tfunction handleEnd(event: Event) {\n\t\tevent.preventDefault();\n\t\tdocument.removeEventListener(\"mousemove\", handleMove);\n\t\tdocument.removeEventListener(\"mouseup\", handleEnd);\n\t}\n\n\tdocument.addEventListener(\"mousemove\", handleMove);\n\tdocument.addEventListener(\"mouseup\", handleEnd);\n}\n\nfunction watchTouchMove(baseEvent: TouchEvent, handler: PointerMoveHandler) {\n\tconst basePointer = baseEvent.touches[0];\n\n\tfunction handleMove(event: TouchEvent) {\n\t\tconst touch = event.touches[0];\n\t\thandler(touch.pageX - basePointer.pageX, touch.pageY - basePointer.pageY);\n\t}\n\n\tfunction handleEnd(event: Event) {\n\t\tevent.preventDefault();\n\t\tdocument.removeEventListener(\"touchmove\", handleMove);\n\t\tdocument.removeEventListener(\"touchend\", handleEnd);\n\t}\n\n\tdocument.addEventListener(\"touchmove\", handleMove);\n\tdocument.addEventListener(\"touchend\", handleEnd);\n}\n\nexport default function ImageView(props: Props) {\n\tconst { original, width, height, optimized } = props;\n\n\tconst [type, setType] = useState(ViewType.Compressed);\n\tconst [brightness, setBrightness] = useState(100);\n\n\tconst [zoom, setZoom] = useState(1);\n\tconst [offset, setOffset] = useState({ x: 0, y: 0 });\n\n\tconst canvasRef = useRef<HTMLCanvasElement>(null);\n\n\tfunction refreshCanvas() {\n\t\tif (!optimized) {\n\t\t\treturn; // TODO\n\t\t}\n\t\tconst { metrics, bitmap } = optimized;\n\t\tconst ctx = canvasRef.current!.getContext(\"2d\");\n\t\tif (!ctx) {\n\t\t\tthrow new Error(\"Could not create canvas context\");\n\t\t}\n\t\tif (type === ViewType.HeatMap) {\n\t\t\tctx.drawImage(metrics.butteraugli!.heatMap, 0, 0);\n\t\t} else {\n\t\t\tctx.drawImage(bitmap!, 0, 0);\n\t\t}\n\t}\n\n\tuseEffect(refreshCanvas, [type, original, optimized]);\n\n\tinterface ImageViewTabProps {\n\t\ttarget: ViewType;\n\t\tdisabled?: boolean;\n\t\tchildren: ReactNode;\n\t}\n\n\tfunction ImageViewTab(props: ImageViewTabProps) {\n\t\tconst { children, target, disabled } = props;\n\t\treturn <IconButton disabled={disabled} active={type === target} onClick={() => setType(target)}>{children}</IconButton>;\n\t}\n\n\tfunction handleWheel(event: WheelEvent) {\n\t\tconst { ctrlKey, deltaMode } = event;\n\t\tlet { deltaY } = event;\n\n\t\tevent.preventDefault();\n\n\t\t// 1 is \"lines\", 0 is \"pixels\"\n\t\tif (deltaMode === 1) {\n\t\t\tdeltaY *= 15; // Firefox uses \"lines\" for some types of mouse\n\t\t}\n\n\t\t// ctrlKey is true when pinch-zooming on a trackpad.\n\t\tconst divisor = ctrlKey ? 100 : 300;\n\t\tsetZoom(zoom * (1 - deltaY / divisor));\n\t}\n\n\tfunction offsetUpdater() {\n\t\tconst baseX = offset.x;\n\t\tconst baseY = offset.y;\n\n\t\treturn (dx: number, dy: number) => {\n\t\t\tconst x = baseX + dx;\n\t\t\tconst y = baseY + dy;\n\t\t\tsetOffset({ x, y });\n\t\t};\n\t}\n\n\tlet brightnessInput = null;\n\tlet brightnessVal = 100;\n\n\tif (type === ViewType.AbsDiff) {\n\t\tbrightnessVal = brightness;\n\t\tbrightnessInput = (\n\t\t\t<label>\n\t\t\t\tBrightness:\n\t\t\t\t<NumberInput\n\t\t\t\t\tvalue={brightness}\n\t\t\t\t\tmin={100}\n\t\t\t\t\tstep={50}\n\t\t\t\t\tonChange={setBrightness}\n\t\t\t\t/>\n\t\t\t</label>\n\t\t);\n\t}\n\n\tconst wrapperCss: ImageViewCSS = {\n\t\twidth, height,\n\t\t\"--original\": `url(\"${original}\")`,\n\t\t\"--scale\": zoom,\n\t\t\"--x\": offset.x + \"px\",\n\t\t\"--y\": offset.y + \"px\",\n\t\t\"--brightness\": `${brightnessVal}%`,\n\t};\n\n\tconst blend = type === ViewType.AbsDiff ? \"difference\" : undefined;\n\tconst butteraugliAvaliable = !optimized?.metrics.butteraugli;\n\n\treturn (\n\t\t<section\n\t\t\tclassName={Styles.container}\n\t\t\tonWheel={handleWheel}\n\t\t>\n\t\t\t<aside className={Styles.inputs}>\n\t\t\t\t<div>\n\t\t\t\t\t<ImageViewTab target={ViewType.Original}>Original</ImageViewTab>\n\t\t\t\t\t<ImageViewTab target={ViewType.Compressed}>Compressed</ImageViewTab>\n\t\t\t\t\t<ImageViewTab target={ViewType.AbsDiff}>AbsDiff</ImageViewTab>\n\t\t\t\t\t<ImageViewTab\n\t\t\t\t\t\tdisabled={butteraugliAvaliable}\n\t\t\t\t\t\ttarget={ViewType.HeatMap}\n\t\t\t\t\t>\n\t\t\t\t\t\tHeatMap\n\t\t\t\t\t</ImageViewTab>\n\t\t\t\t</div>\n\t\t\t\t{brightnessInput}\n\t\t\t</aside>\n\t\t\t<div\n\t\t\t\tclassName={Styles.wrapper}\n\t\t\t\tstyle={wrapperCss}\n\t\t\t\tonMouseDown={e => watchMouseMove(e.nativeEvent, offsetUpdater())}\n\t\t\t\tonTouchStart={e => watchTouchMove(e.nativeEvent, offsetUpdater())}\n\t\t\t>\n\t\t\t\t<canvas\n\t\t\t\t\tclassName={Styles.canvas}\n\t\t\t\t\tstyle={{ mixBlendMode: blend }}\n\t\t\t\t\tref={canvasRef}\n\t\t\t\t\twidth={width}\n\t\t\t\t\theight={height}\n\t\t\t\t\thidden={type === ViewType.Original}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</section>\n\t);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"container\":\"_3rEMC\",\"inputs\":\"_36o9S controls\",\"wrapper\":\"_1me0h\",\"canvas\":\"_3BNiC\"};","import React, { FormEvent, useState } from \"react\";\nimport IconButton from \"./IconButton\";\nimport CompressDialog from \"./CompressDialog\";\nimport Chart from \"./Chart\";\nimport style from \"./App.scss\";\nimport RangeInput from \"./RangeInput\";\nimport ImageView from \"./ImageView\";\nimport UploadIcon from \"bootstrap-icons/icons/cloud-upload.svg\";\nimport ChartIcon from \"bootstrap-icons/icons/bar-chart-line.svg\";\nimport DownloadIcon from \"bootstrap-icons/icons/download.svg\";\nimport { ConvertOutput } from \"../encoding\";\n\ninterface Result {\n\toriginal: string;\n\twidth: number;\n\theight: number;\n\toutputs: ConvertOutput[];\n}\n\nconst PLACEHOLDER: Result = {\n\toriginal: \"\",\n\twidth: 0,\n\theight: 0,\n\toutputs: [],\n};\n\nexport default function App() {\n\tconst [showDialog, setShowDialog] = useState(false);\n\tconst [showChart, setShowChart] = useState(false);\n\tconst [index, setIndex] = useState(0);\n\tconst [results, setResults] = useState(PLACEHOLDER);\n\tconst [downloadUrl, setDownloadUrl] = useState(\"\");\n\n\tasync function showResult(file: File, outputs: ConvertOutput[]) {\n\t\tsetShowDialog(false);\n\n\t\tURL.revokeObjectURL(results.original);\n\n\t\tsetResults({\n\t\t\toutputs,\n\t\t\toriginal: URL.createObjectURL(file),\n\t\t\twidth: outputs[0].bitmap.width,\n\t\t\theight: outputs[0].bitmap.height,\n\t\t});\n\n\t\tsetIndex(75);\n\t}\n\n\tfunction handleIndexChange(e: FormEvent<HTMLInputElement>) {\n\t\tconst i = e.currentTarget.valueAsNumber;\n\t\tsetIndex(i);\n\t\t// setOptimized(results[i]);\n\t\t// canvasRef.current!.getContext(\"2d\")!.drawImage(results[i], 0, 0);\n\t\t// chart.dispatchAction({ type: \"showTip\", x: i, y: 0,position: [\"50%\", \"50%\"] });\n\t}\n\n\tfunction downloadImage() {\n\t\tconst { buffer } = results.outputs[index];\n\t\tconst url = URL.createObjectURL(new Blob([buffer], { type: \"image/webp\" }));\n\n\t\tURL.revokeObjectURL(downloadUrl);\n\t\tsetDownloadUrl(url);\n\n\t\tconst a = document.createElement(\"a\");\n\t\ta.href = url;\n\t\ta.download = \"filename.webp\";\n\t\ta.click();\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<section className={style.main}>\n\n\t\t\t\t<ImageView {...results} optimized={results.outputs[index]}/>\n\n\t\t\t\t{showChart && <Chart options={results}/>}\n\n\t\t\t\t<div className={style.buttonGroup}>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle=\"Select an image\"\n\t\t\t\t\t\tclassName={style.iconButton}\n\t\t\t\t\t\tonClick={() => setShowDialog(true)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<UploadIcon/>\n\t\t\t\t\t</IconButton>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle=\"Show chart\"\n\t\t\t\t\t\tclassName={style.iconButton}\n\t\t\t\t\t\tdisabled={results === PLACEHOLDER}\n\t\t\t\t\t\tactive={showChart}\n\t\t\t\t\t\tonClick={() => setShowChart(!showChart)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChartIcon/>\n\t\t\t\t\t</IconButton>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle=\"Download compressed image\"\n\t\t\t\t\t\tclassName={style.iconButton}\n\t\t\t\t\t\tdisabled={results === PLACEHOLDER}\n\t\t\t\t\t\tonClick={downloadImage}\n\t\t\t\t\t>\n\t\t\t\t\t\t<DownloadIcon/>\n\t\t\t\t\t</IconButton>\n\t\t\t\t</div>\n\n\t\t\t\t<form className={style.variableGroup}>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p>Quality (-q) {index}</p>\n\t\t\t\t\t\t<RangeInput\n\t\t\t\t\t\t\tvalue={index}\n\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\tstep={1}\n\t\t\t\t\t\t\tmax={100}\n\t\t\t\t\t\t\tonChange={handleIndexChange}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</label>\n\t\t\t\t</form>\n\t\t\t</section>\n\n\t\t\t{showDialog && <CompressDialog onClose={() => setShowDialog(false)} onChange={showResult}/>}\n\t\t</>\n\t);\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport App from \"./component/App\";\n\nReactDOM.render(<App/>, document.getElementById(\"root\"));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t826: 0\n};\n\nvar deferredModules = [\n\t[13909,823]\n];\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = () => {\n\n};\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = () => {\n\n\t\t}\n\t}\n\treturn result;\n}\n__webpack_require__.x = () => {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = () => {\n\n\t}\n\tchunkLoadingGlobal = chunkLoadingGlobal.slice();\n\tfor(var i = 0; i < chunkLoadingGlobal.length; i++) webpackJsonpCallback(chunkLoadingGlobal[i]);\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (data) => {\n\tvar [chunkIds, moreModules, runtime, executeModules] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tparentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkic_analyze\"] = self[\"webpackChunkic_analyze\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = webpackJsonpCallback;","// run startup\nreturn __webpack_require__.x();\n"],"sourceRoot":""}